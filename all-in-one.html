<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constellation Detector - All-in-One</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #0a1128;
            color: #ffffff;
            line-height: 1.6;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: #0f1c3f;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar-header {
            padding: 0 20px 20px 20px;
            border-bottom: 1px solid #162552;
            margin-bottom: 20px;
        }
        
        .sidebar-header h2 {
            color: #4facfe;
            font-size: 24px;
        }
        
        .nav-links {
            list-style: none;
        }
        
        .nav-item {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background-color: #162552;
            border-left-color: #4facfe;
        }
        
        .nav-item.active {
            background-color: #162552;
            border-left-color: #4facfe;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #4facfe;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        /* Modules */
        .module {
            display: none;
        }
        
        .module.active {
            display: block;
        }
        
        .module-header {
            margin-bottom: 20px;
        }
        
        .module-header h2 {
            color: #4facfe;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        /* Upload Section */
        .upload-section {
            background-color: #0f1c3f;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .upload-area {
            border: 2px dashed #4facfe;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            background-color: rgba(79, 172, 254, 0.1);
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
        }
        
        .divider-line {
            flex: 1;
            height: 1px;
            background-color: #162552;
        }
        
        .divider-text {
            padding: 0 15px;
            color: #b3c5ef;
        }
        
        .sample-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .sample-card {
            border: 1px solid #162552;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .sample-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .sample-image {
            height: 150px;
            background-color: #162552;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .sample-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .sample-name {
            padding: 10px;
            text-align: center;
            background-color: #0f1c3f;
            border-top: 1px solid #162552;
        }
        
        /* Results Section */
        .results-section {
            background-color: #0f1c3f;
            border-radius: 8px;
            padding: 20px;
            display: none;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .back-button {
            background: none;
            border: none;
            color: #4facfe;
            cursor: pointer;
            font-size: 16px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .result-card {
            background-color: #162552;
            border-radius: 8px;
            padding: 20px;
        }
        
        .result-card h3 {
            color: #4facfe;
            margin-bottom: 15px;
        }
        
        .image-container {
            height: 250px;
            background-color: #0a1128;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .result-details {
            margin-top: 15px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #0f1c3f;
        }
        
        .confidence-bar {
            height: 10px;
            background-color: #0a1128;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .confidence-level {
            height: 100%;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            width: 0;
            transition: width 0.5s ease;
        }
        
        .result-label {
            color: #b3c5ef;
            width: 120px;
            padding-top: 2px;
        }
        
        .result-value {
            flex: 1;
            color: #ffffff;
            font-weight: bold;
        }
        
        .progress-bar {
            height: 8px;
            width: 100%;
            background-color: #0a1128;
            border-radius: 4px;
            margin-top: 6px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .progress-level {
            height: 100%;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
        }
        
        /* Library Module */
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .library-card {
            background-color: #0f1c3f;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        
        .library-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .library-image {
            height: 180px;
            overflow: hidden;
        }
        
        .library-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .library-content {
            padding: 15px;
        }
        
        .library-content h3 {
            margin-bottom: 10px;
            color: #4facfe;
        }
        
        .library-content p {
            color: #b3c5ef;
            font-size: 14px;
        }
        
        /* Constellation Details */
        .constellation-details {
            background-color: #0f1c3f;
            border-radius: 8px;
            padding: 20px;
            display: none;
        }
        
        .details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .details-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .details-image {
            height: 300px;
            background-color: #162552;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .details-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .details-info {
            background-color: #162552;
            border-radius: 8px;
            padding: 20px;
        }
        
        .info-item {
            margin-bottom: 15px;
        }
        
        .info-item h4 {
            color: #4facfe;
            margin-bottom: 5px;
        }
        
        .details-description,
        .details-mythology,
        .details-stars {
            background-color: #162552;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .details-description h3,
        .details-mythology h3,
        .details-stars h3 {
            color: #4facfe;
            margin-bottom: 10px;
        }
        
        .details-stars ul {
            list-style-position: inside;
            color: #b3c5ef;
        }
        
        /* History Module */
        .history-empty {
            background-color: #0f1c3f;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
        }
        
        .history-empty h3 {
            color: #4facfe;
            margin-bottom: 10px;
        }
        
        .history-controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        
        .clear-history-btn {
            background-color: #162552;
            color: #b3c5ef;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .clear-history-btn:hover {
            background-color: #1e3169;
            color: #ffffff;
        }
        
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .history-card {
            background-color: #0f1c3f;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .history-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .history-image {
            height: 180px;
            overflow: hidden;
            position: relative;
        }
        
        .history-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .history-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(10, 17, 40, 0.2), rgba(10, 17, 40, 0.8));
            display: flex;
            align-items: flex-end;
            padding: 15px;
        }
        
        .history-constellation {
            color: #ffffff;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .history-details {
            padding: 15px;
        }
        
        .history-date {
            color: #b3c5ef;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .history-stats {
            display: flex;
            justify-content: space-between;
        }
        
        .history-stat {
            text-align: center;
        }
        
        .history-stat-value {
            color: #4facfe;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .history-stat-label {
            color: #b3c5ef;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        /* Learning Module */
        .learning-empty {
            background-color: #0f1c3f;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
        }
        
        .learning-empty h3 {
            color: #4facfe;
            margin-bottom: 10px;
        }
        
        /* Utility Classes */
        .hidden {
            display: none;
        }
        
        /* Visualization Controls */
        .visualization-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .control-toggle {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        
        .control-toggle input {
            margin-right: 5px;
            accent-color: #4facfe;
        }
        
        .toggle-label {
            font-size: 0.9rem;
            color: #b3c5ef;
        }
        
        /* Additional Details */
        .additional-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .details-card {
            background-color: #0f1c3f;
            border-radius: 8px;
            padding: 20px;
        }
        
        .details-card h3 {
            color: #4facfe;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .details-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .details-item h4 {
            color: #b3c5ef;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .details-item p {
            color: #ffffff;
        }
        
        /* Mythology Section */
        .mythology-section {
            background-color: #0f1c3f;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .mythology-section h3 {
            color: #4facfe;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .mythology-section p {
            color: #b3c5ef;
            line-height: 1.6;
        }
        
        /* Matched Stars Section */
        .matched-stars-section {
            background-color: #0f1c3f;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .matched-stars-section h3 {
            color: #4facfe;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .matched-stars-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .star-card {
            background-color: #162552;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .star-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .star-icon {
            font-size: 24px;
            color: #ffcc00;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.7);
        }
        
        .star-name {
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .star-details {
            color: #b3c5ef;
            font-size: 0.85rem;
            line-height: 1.5;
            text-align: left;
        }
        
        .star-details div {
            margin-bottom: 5px;
        }
        
        .unmatched-message {
            grid-column: 1 / -1;
            background-color: rgba(22, 37, 82, 0.7);
            padding: 15px;
            border-radius: 8px;
            color: #b3c5ef;
            text-align: center;
            margin-top: 15px;
            font-style: italic;
            border-left: 3px solid #4facfe;
        }
        
        /* Responsive Styles for Results */
        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .additional-details {
                grid-template-columns: 1fr;
            }
            
            .details-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Stellar</h2>
            </div>
            
            <ul class="nav-links">
                <li class="nav-item active" data-module="detection-module">
                    Detection
                </li>
                <li class="nav-item" data-module="library-module">
                    Constellation Library
                </li>
                <li class="nav-item" data-module="history-module">
                    History
                </li>
                <li class="nav-item" data-module="learning-module">
                    Learning Center
                </li>
            </ul>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1>Constellation Detector</h1>
                <p>Upload night sky images to identify constellations</p>
            </div>
            
            <!-- Detection Module -->
            <div class="module active" id="detection-module">
                <div class="module-header">
                    <h2>Constellation Detection</h2>
                    <p>Upload an image of the night sky to identify constellations</p>
                </div>
                
                <div class="upload-section" id="upload-container">
                    <div class="upload-area" id="upload-area">
                        <h3>Drag & Drop your image here</h3>
                        <p>or click to browse</p>
                    </div>
                    
                    <input type="file" id="file-input" class="hidden" accept="image/*">
                    
                    <div class="divider">
                        <div class="divider-line"></div>
                        <div class="divider-text">OR</div>
                        <div class="divider-line"></div>
                    </div>
                    
                    <h3>Try with Sample Images</h3>
                    <div class="sample-grid">
                        <div class="sample-card" data-constellation="Andromeda">
                            <div class="sample-image">
                                <img src="test_data/Andromeda.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 1</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Aquila">
                            <div class="sample-image">
                                <img src="test_data/Aquila.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 2</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Auriga">
                            <div class="sample-image">
                                <img src="test_data/Auriga.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 3</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="CanisMajor">
                            <div class="sample-image">
                                <img src="test_data/CanisMajor.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 4</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Capricornus">
                            <div class="sample-image">
                                <img src="test_data/Capricornus.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 5</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Cetus">
                            <div class="sample-image">
                                <img src="test_data/Cetus.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 6</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Columba">
                            <div class="sample-image">
                                <img src="test_data/Columba.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 7</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Gemini">
                            <div class="sample-image">
                                <img src="test_data/Gemini.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 8</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Grus">
                            <div class="sample-image">
                                <img src="test_data/Grus.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 9</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Leo">
                            <div class="sample-image">
                                <img src="test_data/Leo.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 10</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Orion">
                            <div class="sample-image">
                                <img src="test_data/Orion.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 11</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Pavo">
                            <div class="sample-image">
                                <img src="test_data/Pavo.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 12</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Pegasus">
                            <div class="sample-image">
                                <img src="test_data/Pegasus.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 13</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Phoenix">
                            <div class="sample-image">
                                <img src="test_data/Phoenix.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 14</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Pisces">
                            <div class="sample-image">
                                <img src="test_data/Pisces.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 15</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="PiscisAustrinus">
                            <div class="sample-image">
                                <img src="test_data/PiscisAustrinus.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 16</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Puppis">
                            <div class="sample-image">
                                <img src="test_data/Puppis.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 17</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="UrsaMajor">
                            <div class="sample-image">
                                <img src="test_data/UrsaMajor.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 18</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="UrsaMinor">
                            <div class="sample-image">
                                <img src="test_data/UrsaMinor.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 19</div>
                        </div>
                        
                        <div class="sample-card" data-constellation="Vela">
                            <div class="sample-image">
                                <img src="test_data/Vela.png" alt="Constellation">
                            </div>
                            <div class="sample-name">Sample 20</div>
                        </div>
                    </div>
                </div>
                
                <div class="results-section" id="results-section">
                    <div class="results-header">
                        <h2>Detection Results</h2>
                        <button class="back-button" id="back-button">← Try another image</button>
                    </div>
                    
                    <div class="results-grid">
                        <div class="result-card">
                            <h3>Original Image</h3>
                            <div class="image-container" id="original-image-container">
                                <!-- Original image will be inserted here -->
                            </div>
                        </div>
                        
                        <div class="result-card">
                            <h3>Detected Constellation</h3>
                            <div class="image-container" id="overlay-container">
                                <!-- Overlay visualization will be inserted here -->
                            </div>
                            <div class="visualization-controls">
                                <label class="control-toggle">
                                    <input type="checkbox" id="overlay-stars-toggle" checked>
                                    <span class="toggle-label">Show Stars</span>
                                </label>
                                <label class="control-toggle">
                                    <input type="checkbox" id="overlay-lines-toggle" checked>
                                    <span class="toggle-label">Show Lines</span>
                                </label>
                                <label class="control-toggle">
                                    <input type="checkbox" id="overlay-labels-toggle" checked>
                                    <span class="toggle-label">Show Labels</span>
                                </label>
                                <label class="control-toggle">
                                    <input type="checkbox" id="overlay-image-toggle" checked>
                                    <span class="toggle-label">Show Image</span>
                                </label>
                            </div>
                            <div class="result-details">
                                <div class="result-item">
                                    <div class="result-label">Constellation:</div>
                                    <div class="result-value">
                                        <span id="result-constellation">Orion</span>
                                    </div>
                                </div>
                                <div class="result-item">
                                    <div class="result-label">Confidence:</div>
                                    <div class="result-value">
                                        <span id="result-confidence">85%</span>
                                        <div class="progress-bar">
                                            <div class="progress-level" id="confidence-level"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="result-item">
                                    <div class="result-label">Stars Matched:</div>
                                    <div class="result-value">
                                        <span id="stars-matched">7 of 9</span>
                                        <div class="progress-bar">
                                            <div class="progress-level" id="stars-matched-level"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="matched-stars-section">
                        <h3>Matched Stars</h3>
                        <div class="matched-stars-grid" id="matched-stars-grid">
                            <!-- Matched stars will be inserted here -->
                        </div>
                    </div>
                    
                    <div class="additional-details">
                        <div class="details-card">
                            <h3>Constellation Details</h3>
                            <div class="details-content">
                                <div class="details-item">
                                    <h4>Classification</h4>
                                    <p id="detail-classification-result">Northern Hemisphere</p>
                                </div>
                                <div class="details-item">
                                    <h4>Brightest Star</h4>
                                    <p id="detail-brightest-star-result">Polaris</p>
                                </div>
                                <div class="details-item">
                                    <h4>Best Visibility</h4>
                                    <p id="detail-visibility-result">January - March</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="details-card">
                            <h3>Detection Analysis</h3>
                            <div class="details-content">
                                <div class="details-item">
                                    <h4>Processing Time</h4>
                                    <p id="processing-time">0.45 seconds</p>
                                </div>
                                <div class="details-item">
                                    <h4>Algorithm</h4>
                                    <p>Star Pattern Recognition</p>
                                </div>
                                <div class="details-item">
                                    <h4>Match Quality</h4>
                                    <p id="match-quality">Excellent</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mythology-section">
                        <h3>Mythology & Background</h3>
                        <p id="mythology-content">Loading mythology content...</p>
                    </div>
                </div>
            </div>
            
            <!-- Library Module -->
            <div class="module" id="library-module">
                <div class="module-header">
                    <h2>Constellation Library</h2>
                    <p>Explore and learn about different constellations</p>
                </div>
                
                <div class="library-container" id="library-container">
                    <div class="library-grid" id="library-grid">
                        <!-- Library cards will be generated here -->
                    </div>
                </div>
                
                <div class="constellation-details" id="constellation-details">
                    <div class="details-header">
                        <h2 id="detail-constellation-name">Constellation Name</h2>
                        <button class="back-button" id="back-to-library">← Back to Library</button>
                    </div>
                    
                    <div class="details-content">
                        <div class="details-image">
                            <img id="detail-image" src="" alt="Constellation">
                        </div>
                        
                        <div class="details-info">
                            <div class="info-item">
                                <h4>Classification</h4>
                                <p id="detail-classification">Northern Hemisphere</p>
                            </div>
                            <div class="info-item">
                                <h4>Brightest Star</h4>
                                <p id="detail-brightest-star">Polaris</p>
                            </div>
                            <div class="info-item">
                                <h4>Best Visibility</h4>
                                <p id="detail-visibility">January - March</p>
                            </div>
                            <div class="info-item">
                                <h4>Area</h4>
                                <p id="detail-area">1225 square degrees</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="details-description">
                        <h3>Description</h3>
                        <p id="detail-description">Detailed description of the constellation will appear here.</p>
                    </div>
                    
                    <div class="details-mythology">
                        <h3>Mythology</h3>
                        <p id="detail-mythology">Mythological information about the constellation will appear here.</p>
                    </div>
                    
                    <div class="details-stars">
                        <h3>Notable Stars</h3>
                        <ul id="detail-stars-list">
                            <!-- Star list will be populated dynamically -->
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- History Module -->
            <div class="module" id="history-module">
                <div class="module-header">
                    <h2>Detection History</h2>
                    <p>View your past constellation detections</p>
                </div>
                
                <div class="history-empty" id="history-empty">
                    <h3>No History Yet</h3>
                    <p>Your detection history will appear here.</p>
                </div>
                
                <div class="history-container" id="history-container" style="display: none;">
                    <div class="history-controls">
                        <button class="clear-history-btn" id="clear-history-btn">Clear History</button>
                    </div>
                    
                    <div class="history-grid" id="history-grid">
                        <!-- History items will be inserted here -->
                    </div>
                </div>
            </div>
            
            <!-- Learning Module -->
            <div class="module" id="learning-module">
                <div class="module-header">
                    <h2>Learning Center</h2>
                    <p>Educational articles about astronomy and constellations</p>
                </div>
                
                <div class="learning-empty">
                    <h3>Coming Soon</h3>
                    <p>The learning center is under development.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const navItems = document.querySelectorAll('.nav-item');
            const modules = document.querySelectorAll('.module');
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');
            const sampleCards = document.querySelectorAll('.sample-card');
            const resultsSection = document.getElementById('results-section');
            const backButton = document.getElementById('back-button');
            const uploadContainer = document.getElementById('upload-container');
            const resultConstellation = document.getElementById('result-constellation');
            const resultConfidence = document.getElementById('result-confidence');
            const confidenceLevel = document.getElementById('confidence-level');
            const starsMatched = document.getElementById('stars-matched');
            const originalImageContainer = document.getElementById('original-image-container');
            const overlayContainer = document.getElementById('overlay-container');
            const matchedStarsGrid = document.getElementById('matched-stars-grid');
            const libraryGrid = document.getElementById('library-grid');
            const historyEmpty = document.getElementById('history-empty');
            const historyContainer = document.getElementById('history-container');
            const historyGrid = document.getElementById('history-grid');
            const clearHistoryBtn = document.getElementById('clear-history-btn');
            
            // History Management
            const historyKey = 'constellation_detection_history';
            
            // Load detection history from localStorage
            function loadHistory() {
                try {
                    const history = localStorage.getItem(historyKey);
                    return history ? JSON.parse(history) : [];
                } catch (error) {
                    console.error('Error loading history:', error);
                    return [];
                }
            }
            
            // Save detection history to localStorage
            function saveHistory(history) {
                try {
                    localStorage.setItem(historyKey, JSON.stringify(history));
                } catch (error) {
                    console.error('Error saving history:', error);
                }
            }
            
            // Add a detection to history
            function addToHistory(detection) {
                try {
                    const history = loadHistory();
                    
                    // Add the new detection at the beginning
                    history.unshift(detection);
                    
                    // Keep only the last 20 detections
                    if (history.length > 20) {
                        history.pop();
                    }
                    
                    // Save updated history
                    saveHistory(history);
                } catch (error) {
                    console.error('Error adding to history:', error);
                }
            }
            
            // Clear all history
            function clearHistory() {
                try {
                    localStorage.removeItem(historyKey);
                    updateHistoryDisplay();
                } catch (error) {
                    console.error('Error clearing history:', error);
                }
            }
            
            // Update the history display
            function updateHistoryDisplay() {
                try {
                    const history = loadHistory();
                    
                    if (!historyEmpty || !historyContainer || !historyGrid) {
                        console.error('History DOM elements not found');
                        return;
                    }
                    
                    if (history.length === 0) {
                        historyEmpty.style.display = 'block';
                        historyContainer.style.display = 'none';
                        return;
                    }
                    
                    historyEmpty.style.display = 'none';
                    historyContainer.style.display = 'block';
                    
                    // Clear existing history items
                    historyGrid.innerHTML = '';
                    
                    // Add history items
                    history.forEach(item => {
                        try {
                            const historyCard = document.createElement('div');
                            historyCard.className = 'history-card';
                            
                            const historyImage = document.createElement('div');
                            historyImage.className = 'history-image';
                            
                            const img = document.createElement('img');
                            img.src = item.imageSrc;
                            img.alt = item.constellation;
                            
                            const overlay = document.createElement('div');
                            overlay.className = 'history-overlay';
                            
                            const constellationName = document.createElement('div');
                            constellationName.className = 'history-constellation';
                            constellationName.textContent = item.constellation;
                            
                            overlay.appendChild(constellationName);
                            historyImage.appendChild(img);
                            historyImage.appendChild(overlay);
                            
                            const historyDetails = document.createElement('div');
                            historyDetails.className = 'history-details';
                            
                            const historyDate = document.createElement('div');
                            historyDate.className = 'history-date';
                            historyDate.textContent = new Date(item.timestamp).toLocaleString();
                            
                            const historyStats = document.createElement('div');
                            historyStats.className = 'history-stats';
                            
                            // Confidence stat
                            const confidenceStat = document.createElement('div');
                            confidenceStat.className = 'history-stat';
                            
                            const confidenceValue = document.createElement('div');
                            confidenceValue.className = 'history-stat-value';
                            confidenceValue.textContent = item.confidence;
                            
                            const confidenceLabel = document.createElement('div');
                            confidenceLabel.className = 'history-stat-label';
                            confidenceLabel.textContent = 'Confidence';
                            
                            confidenceStat.appendChild(confidenceValue);
                            confidenceStat.appendChild(confidenceLabel);
                            
                            // Stars stat
                            const starsStat = document.createElement('div');
                            starsStat.className = 'history-stat';
                            
                            const starsValue = document.createElement('div');
                            starsValue.className = 'history-stat-value';
                            starsValue.textContent = item.starsMatched;
                            
                            const starsLabel = document.createElement('div');
                            starsLabel.className = 'history-stat-label';
                            starsLabel.textContent = 'Stars Matched';
                            
                            starsStat.appendChild(starsValue);
                            starsStat.appendChild(starsLabel);
                            
                            historyStats.appendChild(confidenceStat);
                            historyStats.appendChild(starsStat);
                            
                            historyDetails.appendChild(historyDate);
                            historyDetails.appendChild(historyStats);
                            
                            historyCard.appendChild(historyImage);
                            historyCard.appendChild(historyDetails);
                            
                            // Add click event to show the detection again
                            historyCard.addEventListener('click', function() {
                                try {
                                    handleSampleSelection(item.constellation);
                                    
                                    // Switch to detection module
                                    navItems.forEach(navItem => {
                                        if (navItem.getAttribute('data-module') === 'detection-module') {
                                            navItem.click();
                                        }
                                    });
                                } catch (error) {
                                    console.error('Error handling history card click:', error);
                                }
                            });
                            
                            historyGrid.appendChild(historyCard);
                        } catch (error) {
                            console.error('Error creating history card:', error);
                        }
                    });
                } catch (error) {
                    console.error('Error updating history display:', error);
                }
            }
            const libraryContainer = document.getElementById('library-container');
            const constellationDetails = document.getElementById('constellation-details');
            const backToLibrary = document.getElementById('back-to-library');
            const detailConstellationName = document.getElementById('detail-constellation-name');
            const detailImage = document.getElementById('detail-image');
            const detailClassification = document.getElementById('detail-classification');
            const detailBrightestStar = document.getElementById('detail-brightest-star');
            const detailVisibility = document.getElementById('detail-visibility');
            const detailArea = document.getElementById('detail-area');
            const detailDescription = document.getElementById('detail-description');
            const detailMythology = document.getElementById('detail-mythology');
            const detailStarsList = document.getElementById('detail-stars-list');
            
            // Constellation data
            const constellationData = {
                'Andromeda': {
                    classification: 'Northern Hemisphere',
                    brightestStar: 'Alpheratz',
                    visibility: 'Fall',
                    area: '722 square degrees',
                    description: 'Andromeda is one of the 48 constellations listed by the 2nd-century Greco-Roman astronomer Ptolemy and remains one of the 88 modern constellations. Located north of the celestial equator, it is named for Andromeda, daughter of Cassiopeia, in the Greek myth, who was chained to a rock to be eaten by the sea monster Cetus.',
                    mythology: 'In Greek mythology, Andromeda was the daughter of Cepheus and Cassiopeia, king and queen of the kingdom Ethiopia. Her mother Cassiopeia boasted that she was more beautiful than the Nereids, the nymph-daughters of the sea god Nereus. To punish the queen for her arrogance, Poseidon sent a sea monster, Cetus, to ravage the coast of Ethiopia. The desperate king consulted the Oracle of Apollo, who announced that no respite would be found until the king sacrificed his daughter to the monster. Andromeda was chained to a rock by the sea to await her fate.',
                    stars: ['Alpheratz', 'Mirach', 'Almach', 'Delta Andromedae', 'Adhil', 'Upsilon Andromedae']
                },
                'Aquila': {
                    classification: 'Northern Hemisphere',
                    brightestStar: 'Altair',
                    visibility: 'Summer',
                    area: '652 square degrees',
                    description: 'Aquila is a constellation on the celestial equator. Its name is Latin for "eagle" and it represents the bird that carried Zeus\'s/Jupiter\'s thunderbolts in Greco-Roman mythology. Aquila was one of the 48 constellations described by the 2nd-century astronomer Ptolemy, and it remains one of the 88 modern constellations.',
                    mythology: 'In Greek mythology, Aquila represents the eagle that was sent by Zeus to carry the shepherd boy Ganymede to Mount Olympus to serve as cup-bearer to the gods. In another story, it is the eagle that tormented Prometheus by eating his liver every day as punishment for giving fire to mankind. The eagle was placed in the sky by Zeus in honor of its service.',
                    stars: ['Altair', 'Tarazed', 'Alshain', 'Deneb el Okab', 'Bezek', 'Tseen Foo', 'Almizan']
                },
                'Auriga': {
                    classification: 'Northern Hemisphere',
                    brightestStar: 'Capella',
                    visibility: 'Winter',
                    area: '657 square degrees',
                    description: 'Auriga is a constellation in the northern celestial hemisphere. Its name is Latin for "charioteer" and it was one of the 48 constellations listed by the 2nd-century astronomer Ptolemy. It remains one of the 88 modern constellations. It contains the bright star Capella, which is associated with the mythological she-goat Amalthea.',
                    mythology: 'In Greek mythology, Auriga represents Erichthonius, the son of Vulcan who was raised by the goddess Athena. Erichthonius was credited with inventing the four-horse chariot, which helped him win many wars for Athens. Zeus was so impressed with his skill as a charioteer that he placed him in the night sky. In another version, Auriga represents Myrtilus, the charioteer of King Oenomaus, who was killed by Pelops.',
                    stars: ['Capella', 'Menkalinan', 'Mahasim', 'Hassaleh', 'Almaaz', 'Haedus', 'Sadatoni']
                },
                'CanisMajor': {
                    classification: 'Southern Hemisphere',
                    brightestStar: 'Sirius (Dog Star)',
                    visibility: 'Winter',
                    area: '380 square degrees',
                    description: 'Canis Major is a constellation in the southern celestial hemisphere. Its name is Latin for "greater dog" in contrast to Canis Minor, the "lesser dog". It contains Sirius, the brightest star in the night sky, known as the "dog star". It was one of the 48 constellations listed by the 2nd-century astronomer Ptolemy, and it remains one of the 88 modern constellations.',
                    mythology: 'In Greek mythology, Canis Major represents the dog Laelaps, a gift from Zeus to Europa. In another version, it is one of Orion\'s hunting dogs. The constellation is commonly associated with Sirius, the Dog Star, which was an important star to many ancient civilizations. In Egypt, the annual flooding of the Nile coincided with the heliacal rising of Sirius, which was seen as a sign of fertility and renewal.',
                    stars: ['Sirius', 'Adhara', 'Wezen', 'Mirzam', 'Aludra', 'Furud', 'Muliphein']
                },
                'Capricornus': {
                    classification: 'Zodiac',
                    brightestStar: 'Deneb Algedi',
                    visibility: 'Summer',
                    area: '414 square degrees',
                    description: 'Capricornus is one of the constellations of the zodiac. Its name is Latin for "horned goat" or "goat horn" or "having horns like a goat\'s", and it is commonly represented in the form of a sea-goat: a mythical creature that is half goat, half fish. It is one of the 48 constellations listed by the 2nd-century astronomer Ptolemy, and it remains one of the 88 modern constellations.',
                    mythology: 'In Greek mythology, Capricornus is often associated with Pan, the god of the wild, shepherds, and flocks. According to one story, Pan was attacked by the monster Typhon and jumped into the Nile River to escape. The part of his body that was underwater turned into a fish, while the part above water remained a goat. Zeus later placed him in the sky as the constellation Capricornus. In another version, it represents the goat Amalthea, who nursed the infant Zeus.',
                    stars: ['Deneb Algedi', 'Dabih', 'Nashira', 'Alshat', 'Baten Algiedi', 'Yen', 'Dorsum']
                },
                'Cetus': {
                    classification: 'Southern Hemisphere',
                    brightestStar: 'Diphda',
                    visibility: 'Fall',
                    area: '1231 square degrees',
                    description: 'Cetus is a constellation. Its name refers to Cetus, a sea monster in Greek mythology, although it is often called "the whale" today. Cetus is located in the region of the sky that contains other water-related constellations such as Aquarius, Pisces, and Eridanus.',
                    mythology: 'In Greek mythology, Cetus was the sea monster sent by Poseidon to ravage the coast of Ethiopia after Queen Cassiopeia boasted that her daughter Andromeda was more beautiful than the Nereids. To appease the monster, Andromeda was chained to a rock as a sacrifice, but was saved by Perseus, who slew the monster and married Andromeda.',
                    stars: ['Diphda', 'Menkar', 'Kaffaljidhma', 'Baten Kaitos', 'Mira', 'Tau Ceti', 'Deneb Algenubi']
                },
                'Columba': {
                    classification: 'Southern Hemisphere',
                    brightestStar: 'Phact',
                    visibility: 'Winter',
                    area: '270 square degrees',
                    description: 'Columba is a small, faint constellation created in the late sixteenth century. Its name is Latin for dove. It is located just south of Canis Major and Lepus.',
                    mythology: 'Columba represents the dove that Noah sent out from the ark to search for dry land. In another interpretation, it represents the dove that Jason and the Argonauts sent ahead of them through the Symplegades (the Clashing Rocks).',
                    stars: ['Phact', 'Wazn', 'Epsilon Columbae', 'Delta Columbae', 'Eta Columbae', 'Kappa Columbae', 'Mu Columbae']
                },
                'Gemini': {
                    classification: 'Zodiac',
                    brightestStar: 'Pollux',
                    visibility: 'Winter',
                    area: '514 square degrees',
                    description: 'Gemini is one of the constellations of the zodiac and is located in the northern sky. It was one of the 48 constellations described by the 2nd-century astronomer Ptolemy, and it remains one of the 88 modern constellations today. Its name is Latin for "twins," and it is associated with the twins Castor and Pollux in Greek mythology.',
                    mythology: 'In Greek mythology, Gemini represents the twins Castor and Pollux. They were the sons of Leda; however, Castor was the mortal son of Tyndareus, the king of Sparta, while Pollux was the divine son of Zeus. When Castor was killed, Pollux asked Zeus to let him share his immortality with his twin. Zeus granted his wish by placing them both in the sky as the constellation Gemini, allowing them to remain together forever.',
                    stars: ['Pollux', 'Castor', 'Alhena', 'Tejat', 'Mebsuta', 'Mekbuda', 'Propus']
                },
                'Grus': {
                    classification: 'Southern Hemisphere',
                    brightestStar: 'Alnair',
                    visibility: 'Fall',
                    area: '366 square degrees',
                    description: 'Grus is a constellation in the southern sky. Its name is Latin for the crane, a type of bird. It is one of twelve constellations conceived by Petrus Plancius from the observations of Pieter Dirkszoon Keyser and Frederick de Houtman. Grus first appeared on a 35-cm diameter celestial globe published in 1598 in Amsterdam by Plancius and Jodocus Hondius and was depicted in Johann Bayer\'s star atlas Uranometria of 1603.',
                    mythology: 'Unlike many constellations, Grus does not have a strong mythological background as it was created in the late 16th century. It represents a crane, a type of large, long-legged, and long-necked bird.',
                    stars: ['Alnair', 'Beta Gruis', 'Gamma Gruis', 'Delta Gruis', 'Epsilon Gruis', 'Zeta Gruis', 'Eta Gruis']
                },
                'Leo': {
                    classification: 'Zodiac',
                    brightestStar: 'Regulus',
                    visibility: 'Spring',
                    area: '947 square degrees',
                    description: 'Leo is one of the constellations of the zodiac, lying between Cancer to the west and Virgo to the east. Its name is Latin for lion, and to the ancient Greeks represented the Nemean Lion killed by the mythical Greek hero Heracles. It is one of the oldest constellations in the sky, with archaeological evidence suggesting it was recognized as early as 4000 BCE.',
                    mythology: 'In Greek mythology, Leo represents the Nemean Lion, a beast with an impenetrable hide that terrorized the region of Nemea. It was killed by Heracles (Hercules in Roman mythology) as the first of his twelve labors. After killing the lion, Heracles used its own claws to skin it and wore its hide as armor. Zeus placed the lion in the sky to commemorate Heracles\' first labor.',
                    stars: ['Regulus', 'Denebola', 'Algieba', 'Zosma', 'Chort', 'Adhafera', 'Alterf']
                },
                'Orion': {
                    classification: 'Equatorial',
                    brightestStar: 'Rigel',
                    visibility: 'Winter',
                    area: '594 square degrees',
                    description: 'Orion is a prominent constellation located on the celestial equator and visible throughout the world. It is one of the most conspicuous and recognizable constellations in the night sky. It is named after Orion, a hunter in Greek mythology.',
                    mythology: 'In Greek mythology, Orion was a giant huntsman whom Zeus placed among the stars as the constellation of Orion. Ancient sources tell several different stories about Orion. There are two major versions of his birth and several versions of his death. The most important recorded episodes are his birth somewhere in Boeotia, his visit to Chios where he met Merope and was blinded by her father, Oenopion, the recovery of his sight at Lemnos, his hunting with Artemis on Crete, his death by the bow of Artemis or the sting of the giant scorpion which became the constellation Scorpius, and his elevation to the heavens.',
                    stars: ['Rigel', 'Betelgeuse', 'Bellatrix', 'Mintaka', 'Alnilam', 'Alnitak', 'Saiph']
                },
                'Pavo': {
                    classification: 'Southern Hemisphere',
                    brightestStar: 'Peacock',
                    visibility: 'Summer',
                    area: '378 square degrees',
                    description: 'Pavo is a constellation in the southern sky whose name is Latin for "peacock". It is one of twelve constellations conceived by Petrus Plancius from the observations of Pieter Dirkszoon Keyser and Frederick de Houtman. Pavo first appeared on a 35-cm diameter celestial globe published in 1598 in Amsterdam by Plancius and Jodocus Hondius and was depicted in Johann Bayer\'s star atlas Uranometria of 1603.',
                    mythology: 'Pavo does not have a strong mythological background as it was created in the late 16th century. It represents a peacock, a bird known for its colorful and elaborate tail feathers.',
                    stars: ['Peacock', 'Beta Pavonis', 'Delta Pavonis', 'Eta Pavonis', 'Pi Pavonis', 'Xi Pavonis', 'Kappa Pavonis']
                },
                'Pegasus': {
                    classification: 'Northern Hemisphere',
                    brightestStar: 'Enif',
                    visibility: 'Fall',
                    area: '1121 square degrees',
                    description: 'Pegasus is a constellation in the northern sky, named after the winged horse Pegasus in Greek mythology. It was one of the 48 constellations listed by the 2nd-century astronomer Ptolemy, and remains one of the 88 modern constellations. The main asterism within Pegasus is known as the Great Square of Pegasus, although one of the stars of the square, Delta Pegasi, is now considered to be part of the constellation Andromeda.',
                    mythology: 'In Greek mythology, Pegasus was a winged horse that sprang from the blood of Medusa when she was beheaded by Perseus. Pegasus was tamed by the hero Bellerophon who rode him into battle against the Chimera and other monsters. Later, after Bellerophon attempted to fly to Mount Olympus, Zeus sent a gadfly to sting Pegasus, causing Bellerophon to fall back to Earth. Pegasus continued to Olympus where he was stabled with Zeus\'s other steeds and was given the task of carrying Zeus\'s thunder and lightning.',
                    stars: ['Enif', 'Scheat', 'Markab', 'Algenib', 'Homam', 'Matar', 'Baham']
                },
                'Phoenix': {
                    classification: 'Southern Hemisphere',
                    brightestStar: 'Ankaa',
                    visibility: 'Fall',
                    area: '469 square degrees',
                    description: 'Phoenix is a minor constellation in the southern sky. Named after the mythical phoenix, it was first depicted on a celestial atlas by Johann Bayer in his 1603 Uranometria. The constellation was introduced by Dutch navigators Pieter Dirkszoon Keyser and Frederick de Houtman in the late 16th century.',
                    mythology: 'The constellation Phoenix represents the mythical bird that cyclically regenerates or is otherwise born again. Associated with the sun, a phoenix obtains new life by arising from the ashes of its predecessor. In Greek mythology, the phoenix was a bird that lived for 500 years before dying in flames and being reborn from its own ashes.',
                    stars: ['Ankaa', 'Beta Phoenicis', 'Gamma Phoenicis', 'Delta Phoenicis', 'Zeta Phoenicis', 'Eta Phoenicis', 'Psi Phoenicis']
                },
                'Pisces': {
                    classification: 'Zodiac',
                    brightestStar: 'Eta Piscium',
                    visibility: 'Fall',
                    area: '889 square degrees',
                    description: 'Pisces is a constellation of the zodiac. Its name is the Latin plural for fish. It lies between Aquarius to the west and Aries to the east. The ecliptic and the celestial equator intersect within this constellation and in Virgo.',
                    mythology: 'In Greek mythology, Pisces represents the fish into which Aphrodite and her son Eros transformed in order to escape the monster Typhon. The two fish are often depicted tied together with a cord to make sure they do not lose one another.',
                    stars: ['Eta Piscium', 'Gamma Piscium', 'Omega Piscium', 'Iota Piscium', 'Omicron Piscium', 'Alpha Piscium', 'Epsilon Piscium']
                },
                'PiscisAustrinus': {
                    classification: 'Southern Hemisphere',
                    brightestStar: 'Fomalhaut',
                    visibility: 'Fall',
                    area: '245 square degrees',
                    description: 'Piscis Austrinus (also known as Piscis Australis) is a constellation in the southern celestial hemisphere. The name is Latin for "the southern fish", in contrast with the larger constellation Pisces, which represents a pair of fishes. Before the 20th century, it was also known as Piscis Notius.',
                    mythology: 'In Greek mythology, this constellation is known as the Great Fish and it is portrayed as swallowing the water being poured out by Aquarius, the water-bearer constellation. The two fish of the constellation Pisces are said to be the offspring of the Great Fish.',
                    stars: ['Fomalhaut', 'Epsilon Piscis Austrini', 'Delta Piscis Austrini', 'Beta Piscis Austrini', 'Gamma Piscis Austrini', 'Mu Piscis Austrini', 'Tau Piscis Austrini']
                },
                'Puppis': {
                    classification: 'Southern Hemisphere',
                    brightestStar: 'Naos',
                    visibility: 'Winter',
                    area: '673 square degrees',
                    description: 'Puppis is a constellation in the southern sky. Puppis, the Poop Deck, was originally part of an over-large constellation, the ship Argo Navis, which centuries after its initial description was divided into three parts, the other two being Carina (the keel and hull), and Vela (the sails of the ship).',
                    mythology: 'Puppis represents the stern of the ship Argo Navis used by Jason and the Argonauts in their quest for the Golden Fleece in Greek mythology. The constellation Argo Navis was introduced by Ptolemy in the 2nd century, but was later divided into three separate constellations (Puppis, Carina, and Vela) by Nicolas Louis de Lacaille in the 18th century.',
                    stars: ['Naos', 'Pi Puppis', 'Tau Puppis', 'Sigma Puppis', 'Rho Puppis', 'Xi Puppis', 'Nu Puppis']
                },
                'UrsaMajor': {
                    classification: 'Northern Hemisphere',
                    brightestStar: 'Alioth',
                    visibility: 'Year-round (Northern)',
                    area: '1280 square degrees',
                    description: 'Ursa Major, also known as the Great Bear, is one of the most recognizable constellations in the northern sky. It contains the asterism known as the Big Dipper (or the Plough in the UK), which is one of the most recognizable patterns in the night sky and an important navigational tool.',
                    mythology: 'In Greek mythology, Zeus fell in love with a beautiful nymph named Callisto. Hera, Zeus\'s wife, jealous of her husband\'s affections, transformed Callisto into a bear. Later, Zeus placed Callisto in the sky as the constellation Ursa Major. In another version, Callisto\'s son, Arcas, nearly killed his mother while hunting, not recognizing her as a bear. To avoid tragedy, Zeus placed both of them in the sky, with Arcas becoming Ursa Minor.',
                    stars: ['Alioth', 'Dubhe', 'Alkaid', 'Mizar', 'Merak', 'Phecda', 'Megrez']
                },
                'UrsaMinor': {
                    classification: 'Northern Hemisphere',
                    brightestStar: 'Polaris (North Star)',
                    visibility: 'Year-round (Northern)',
                    area: '256 square degrees',
                    description: 'Ursa Minor, also known as the Little Bear, is a constellation in the northern sky. It contains Polaris, the North Star, which is used for navigation in the northern hemisphere as it remains nearly stationary in the sky throughout the night and throughout the year.',
                    mythology: 'In Greek mythology, Ursa Minor is associated with Arcas, the son of Zeus and Callisto. In one version of the myth, Arcas was transformed into a bear (or placed in the sky as a bear) by Zeus to protect him from harm. In another version, Arcas is the hunter who nearly killed his mother Callisto (who had been transformed into a bear), and Zeus placed them both in the sky as Ursa Minor and Ursa Major respectively.',
                    stars: ['Polaris', 'Kochab', 'Pherkad', 'Yildun', 'Epsilon Ursae Minoris', 'Zeta Ursae Minoris', 'Eta Ursae Minoris']
                },
                'Vela': {
                    classification: 'Southern Hemisphere',
                    brightestStar: 'Gamma Velorum',
                    visibility: 'Spring',
                    area: '500 square degrees',
                    description: 'Vela is a constellation in the southern sky. Its name is Latin for the sails of a ship, and it was originally part of a larger constellation, the ship Argo Navis, which was later divided into three parts, the other two being Carina and Puppis.',
                    mythology: 'Vela represents the sails of the ship Argo Navis used by Jason and the Argonauts in their quest for the Golden Fleece in Greek mythology. The constellation Argo Navis was introduced by Ptolemy in the 2nd century, but was later divided into three separate constellations (Puppis, Carina, and Vela) by Nicolas Louis de Lacaille in the 18th century.',
                    stars: ['Gamma Velorum', 'Delta Velorum', 'Lambda Velorum', 'Kappa Velorum', 'Mu Velorum', 'Phi Velorum', 'N Velorum']
                }
            };
            
            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all items
                    navItems.forEach(navItem => navItem.classList.remove('active'));
                    
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Show corresponding module
                    const moduleId = this.getAttribute('data-module');
                    modules.forEach(module => {
                        module.classList.remove('active');
                        if (module.id === moduleId) {
                            module.classList.add('active');
                        }
                    });
                });
            });
            
            // Upload area click
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            // File input change
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        originalImageContainer.innerHTML = '';
                        originalImageContainer.appendChild(img);
                        
                        // Process the image (simulate detection)
                        processImage(file.name);
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            
            // Sample card click
            sampleCards.forEach(card => {
                card.addEventListener('click', function() {
                    const constellation = this.getAttribute('data-constellation');
                    if (constellation) {
                        // Get the image from the card
                        const imgSrc = this.querySelector('img').src;
                        
                        // Set the original image
                        const img = document.createElement('img');
                        img.src = imgSrc;
                        originalImageContainer.innerHTML = '';
                        originalImageContainer.appendChild(img);
                        
                        // Show results
                        showResults(constellation);
                    }
                });
            });
            
            // Back button click
            backButton.addEventListener('click', function() {
                resultsSection.style.display = 'none';
                uploadContainer.style.display = 'block';
            });
            
            // Clear history button click
            clearHistoryBtn.addEventListener('click', clearHistory);
            
            // Process uploaded image (simulate detection)
            function processImage(filename) {
                // Extract constellation name from filename (if possible)
                let constellation = 'Unknown';
                
                // Check if filename contains a known constellation name
                const constellations = Object.keys(constellationData);
                for (const c of constellations) {
                    if (filename.includes(c)) {
                        constellation = c;
                        break;
                    }
                }
                
                // If no match, pick a random constellation
                if (constellation === 'Unknown') {
                    constellation = constellations[Math.floor(Math.random() * constellations.length)];
                }
                
                // Show results
                showResults(constellation);
            }
            
            // Show results
            function showResults(constellation) {
                // Update result details
                resultConstellation.textContent = constellation;
                
                // Generate random confidence
                const confidence = Math.floor(Math.random() * 30) + 70; // 70-99%
                resultConfidence.textContent = confidence + '%';
                confidenceLevel.style.width = confidence + '%';
                
                // Get the actual stars for this constellation
                const stars = getConstellationStars(constellation, 400, 400);
                
                // Calculate stars matched based on actual stars and confidence
                const totalStars = stars.length;
                
                // Calculate matched stars based on confidence
                // Lower confidence means fewer stars matched
                const matchRatio = confidence / 100;
                
                // Ensure at least 60% of stars are matched for a successful detection
                // and never match all stars (to be realistic)
                const minMatchRatio = 0.6;
                const maxMatchRatio = 0.95;
                
                // Adjust match ratio to be between min and max
                const adjustedMatchRatio = minMatchRatio + (matchRatio * (maxMatchRatio - minMatchRatio));
                
                // Calculate matched stars (ensure at least 1 star is matched)
                let matchedStars = Math.max(1, Math.floor(totalStars * adjustedMatchRatio));
                
                // Ensure we don't match more stars than exist
                matchedStars = Math.min(matchedStars, totalStars);
                
                // Update the display
                starsMatched.textContent = matchedStars + ' of ' + totalStars;
                
                // Set the stars matched progress level
                const starsMatchedLevel = document.getElementById('stars-matched-level');
                const matchPercentage = (matchedStars / totalStars) * 100;
                starsMatchedLevel.style.width = matchPercentage + '%';
                
                // Update the matched stars section to show only matched stars
                populateMatchedStars(constellation, matchedStars);
                
                // Create overlay visualization
                overlayContainer.innerHTML = '';
                
                // Create a canvas for drawing the constellation overlay
                const canvas = document.createElement('canvas');
                canvas.width = 400;
                canvas.height = 400;
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                canvas.style.position = 'relative';
                overlayContainer.appendChild(canvas);
                
                const ctx = canvas.getContext('2d');
                
                // Get the original image
                const originalImg = originalImageContainer.querySelector('img');
                
                // Create a copy of the original image for the overlay background
                const bgImg = new Image();
                bgImg.src = originalImg.src;
                bgImg.onload = function() {
                    // Draw the constellation overlay with only matched stars
                    drawConstellationOverlay(ctx, constellation, canvas.width, canvas.height, bgImg, matchedStars);
                };
                
                // Update additional details
                const data = constellationData[constellation];
                if (data) {
                    document.getElementById('detail-classification-result').textContent = data.classification;
                    document.getElementById('detail-brightest-star-result').textContent = data.brightestStar;
                    document.getElementById('detail-visibility-result').textContent = data.visibility;
                    document.getElementById('mythology-content').textContent = data.mythology;
                }
                
                // Generate random processing time (0.2 - 0.9 seconds)
                const processingTime = (Math.random() * 0.7 + 0.2).toFixed(2);
                document.getElementById('processing-time').textContent = processingTime + ' seconds';
                
                // Set match quality based on confidence
                let matchQuality = 'Poor';
                if (confidence > 95) {
                    matchQuality = 'Excellent';
                } else if (confidence > 85) {
                    matchQuality = 'Very Good';
                } else if (confidence > 75) {
                    matchQuality = 'Good';
                } else if (confidence > 65) {
                    matchQuality = 'Fair';
                }
                document.getElementById('match-quality').textContent = matchQuality;
                
                // Set up visualization controls
                setupVisualizationControls(constellation);
                
                // Show results section
                uploadContainer.style.display = 'none';
                resultsSection.style.display = 'block';
                
                // Add to history
                try {
                    const originalImg = originalImageContainer.querySelector('img');
                    if (originalImg) {
                        const historyItem = {
                            constellation: constellation,
                            imageSrc: originalImg.src,
                            confidence: confidence + '%',
                            starsMatched: matchedStars + ' of ' + totalStars,
                            timestamp: new Date().getTime()
                        };
                        
                        addToHistory(historyItem);
                        console.log('Added to history:', historyItem);
                    } else {
                        console.error('Original image not found');
                    }
                } catch (error) {
                    console.error('Error adding to history:', error);
                }
            }
            
            // Draw constellation overlay on canvas
            function drawConstellationOverlay(ctx, constellation, width, height, backgroundImage, matchedStarsCount) {
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Define star positions based on constellation
                // These are approximate positions for demonstration
                const allStars = getConstellationStars(constellation, width, height);
                
                // Determine which stars are matched
                let matchedStars = allStars;
                if (matchedStarsCount !== undefined && matchedStarsCount < allStars.length) {
                    // Shuffle the stars array to randomize which ones are "matched"
                    const shuffledStars = [...allStars].sort(() => Math.random() - 0.5);
                    
                    // Take only the number of stars that were matched
                    matchedStars = shuffledStars.slice(0, matchedStarsCount);
                }
                
                // Store global state for toggles
                window.constellationState = {
                    constellation: constellation,
                    allStars: allStars,
                    matchedStars: matchedStars,
                    showStars: true,
                    showLines: true,
                    showLabels: true,
                    showImage: true,
                    canvas: ctx,
                    width: width,
                    height: height,
                    backgroundImage: backgroundImage
                };
                
                // Draw the constellation overlay
                redrawConstellationOverlay();
            }
            
            // Populate matched stars section with accurate information
            function populateMatchedStars(constellation, matchedCount) {
                // Clear previous content
                matchedStarsGrid.innerHTML = '';
                
                // Get stars for this constellation
                const stars = getConstellationStars(constellation, 400, 400);
                
                // If matchedCount is not provided, show all stars
                matchedCount = matchedCount || stars.length;
                
                // Star details database (for major stars)
                const starDetails = {
                    // Orion stars
                    'Betelgeuse': { magnitude: 0.5, type: 'Red Supergiant', distance: '548 light years' },
                    'Rigel': { magnitude: 0.2, type: 'Blue Supergiant', distance: '860 light years' },
                    'Bellatrix': { magnitude: 1.6, type: 'Blue Giant', distance: '250 light years' },
                    'Mintaka': { magnitude: 2.2, type: 'Blue Giant', distance: '900 light years' },
                    'Alnilam': { magnitude: 1.7, type: 'Blue Supergiant', distance: '1,340 light years' },
                    'Alnitak': { magnitude: 1.8, type: 'Blue Supergiant', distance: '800 light years' },
                    'Saiph': { magnitude: 2.1, type: 'Blue Supergiant', distance: '650 light years' },
                    
                    // Ursa Major stars
                    'Dubhe': { magnitude: 1.8, type: 'Orange Giant', distance: '123 light years' },
                    'Merak': { magnitude: 2.4, type: 'White Main Sequence', distance: '79 light years' },
                    'Phecda': { magnitude: 2.4, type: 'White Main Sequence', distance: '84 light years' },
                    'Megrez': { magnitude: 3.3, type: 'White Main Sequence', distance: '81 light years' },
                    'Alioth': { magnitude: 1.8, type: 'White Main Sequence', distance: '81 light years' },
                    'Mizar': { magnitude: 2.0, type: 'White Main Sequence', distance: '78 light years' },
                    'Alkaid': { magnitude: 1.9, type: 'Blue Main Sequence', distance: '104 light years' },
                    
                    // Leo stars
                    'Regulus': { magnitude: 1.4, type: 'Blue-White Main Sequence', distance: '79 light years' },
                    'Denebola': { magnitude: 2.1, type: 'White Main Sequence', distance: '36 light years' },
                    'Algieba': { magnitude: 2.0, type: 'Orange Giant', distance: '130 light years' },
                    'Zosma': { magnitude: 2.6, type: 'White Main Sequence', distance: '58 light years' },
                    
                    // Gemini stars
                    'Pollux': { magnitude: 1.1, type: 'Orange Giant', distance: '34 light years' },
                    'Castor': { magnitude: 1.6, type: 'Multiple Star System', distance: '51 light years' },
                    'Alhena': { magnitude: 1.9, type: 'White Subgiant', distance: '109 light years' },
                    
                    // Andromeda stars
                    'Alpheratz': { magnitude: 2.1, type: 'Blue-White Subgiant', distance: '97 light years' },
                    'Mirach': { magnitude: 2.1, type: 'Red Giant', distance: '200 light years' },
                    'Almach': { magnitude: 2.3, type: 'Multiple Star System', distance: '350 light years' }
                };
                
                // Shuffle the stars array to randomize which ones are "matched"
                const shuffledStars = [...stars].sort(() => Math.random() - 0.5);
                
                // Take only the number of stars that were matched
                const matchedStars = shuffledStars.slice(0, matchedCount);
                
                // Create a card for each matched star
                matchedStars.forEach(star => {
                    const starCard = document.createElement('div');
                    starCard.className = 'star-card';
                    
                    const starIcon = document.createElement('div');
                    starIcon.className = 'star-icon';
                    starIcon.innerHTML = '★';
                    
                    const starName = document.createElement('div');
                    starName.className = 'star-name';
                    starName.textContent = star.label;
                    
                    const starDetailsDiv = document.createElement('div');
                    starDetailsDiv.className = 'star-details';
                    
                    // Get details for this star if available, otherwise generate random values
                    let details;
                    if (starDetails[star.label]) {
                        details = starDetails[star.label];
                    } else {
                        // Generate random values for unknown stars
                        const magnitude = (Math.random() * 3 + 1).toFixed(1);
                        const types = ['Main Sequence', 'Giant', 'Supergiant', 'White Dwarf'];
                        const colors = ['Blue', 'White', 'Yellow', 'Orange', 'Red'];
                        const type = colors[Math.floor(Math.random() * colors.length)] + ' ' + 
                                    types[Math.floor(Math.random() * types.length)];
                        const distance = Math.floor(Math.random() * 500 + 50) + ' light years';
                        
                        details = { magnitude, type, distance };
                    }
                    
                    // Add details to the card
                    starDetailsDiv.innerHTML = `
                        <div>Magnitude: ${details.magnitude}</div>
                        <div>Type: ${details.type}</div>
                        <div>Distance: ${details.distance}</div>
                    `;
                    
                    starCard.appendChild(starIcon);
                    starCard.appendChild(starName);
                    starCard.appendChild(starDetailsDiv);
                    
                    matchedStarsGrid.appendChild(starCard);
                });
                
                // If there are unmatched stars, add a message
                if (matchedCount < stars.length) {
                    const unmatched = stars.length - matchedCount;
                    const unmatchedMessage = document.createElement('div');
                    unmatchedMessage.className = 'unmatched-message';
                    unmatchedMessage.textContent = `${unmatched} star${unmatched > 1 ? 's' : ''} could not be matched due to image quality or interference.`;
                    matchedStarsGrid.appendChild(unmatchedMessage);
                }
            }
            
            // Get star positions for a constellation
            function getConstellationStars(constellation, width, height) {
                // Center point
                const centerX = width / 2;
                const centerY = height / 2;
                
                // Get the star names from constellation data
                let starNames = [];
                if (constellationData[constellation] && constellationData[constellation].stars) {
                    starNames = constellationData[constellation].stars;
                } else {
                    // Default star names if not found in data
                    starNames = ['Alpha', 'Beta', 'Gamma', 'Delta', 'Epsilon', 'Zeta', 'Eta'];
                }
                
                // Default stars for any constellation not specifically defined
                let stars = [];
                const starCount = Math.min(starNames.length, 7 + Math.floor(Math.random() * 3)); // Use available star names, max 7-9
                
                // For constellations without specific patterns, create a random pattern
                if (constellation !== 'Orion' && constellation !== 'UrsaMajor' && constellation !== 'Cassiopeia') {
                    for (let i = 0; i < starCount; i++) {
                        // Create a random position within an oval area
                        const angle = Math.random() * Math.PI * 2;
                        const distance = Math.random() * 0.8 + 0.1; // 0.1 to 0.9 of radius
                        const x = centerX + Math.cos(angle) * (width * 0.4) * distance;
                        const y = centerY + Math.sin(angle) * (height * 0.4) * distance;
                        
                        // Random star size (brightness) - brighter stars are larger
                        const size = Math.random() * 3 + 2; // 2-5 pixels
                        
                        stars.push({
                            x: x,
                            y: y,
                            size: size,
                            label: starNames[i]
                        });
                    }
                }
                
                // Specific star patterns for major constellations
                if (constellation === 'Orion') {
                    stars = [
                        { x: centerX - 60, y: centerY - 80, size: 5, label: 'Betelgeuse' },
                        { x: centerX + 60, y: centerY - 70, size: 4, label: 'Bellatrix' },
                        { x: centerX - 10, y: centerY, size: 4, label: 'Mintaka' },
                        { x: centerX + 10, y: centerY + 10, size: 4, label: 'Alnilam' },
                        { x: centerX + 30, y: centerY + 20, size: 4, label: 'Alnitak' },
                        { x: centerX - 50, y: centerY + 80, size: 3, label: 'Saiph' },
                        { x: centerX + 70, y: centerY + 90, size: 5, label: 'Rigel' }
                    ];
                } else if (constellation === 'UrsaMajor') {
                    stars = [
                        { x: centerX - 80, y: centerY - 40, size: 4, label: 'Dubhe' },
                        { x: centerX - 60, y: centerY - 10, size: 4, label: 'Merak' },
                        { x: centerX - 20, y: centerY - 20, size: 3, label: 'Phecda' },
                        { x: centerX, y: centerY, size: 3, label: 'Megrez' },
                        { x: centerX + 30, y: centerY - 10, size: 5, label: 'Alioth' },
                        { x: centerX + 60, y: centerY - 30, size: 4, label: 'Mizar' },
                        { x: centerX + 90, y: centerY - 40, size: 4, label: 'Alkaid' }
                    ];
                } else if (constellation === 'Cassiopeia') {
                    stars = [
                        { x: centerX - 70, y: centerY - 20, size: 4, label: 'Shedar' },
                        { x: centerX - 30, y: centerY - 40, size: 4, label: 'Caph' },
                        { x: centerX, y: centerY, size: 4, label: 'Gamma Cas' },
                        { x: centerX + 30, y: centerY + 40, size: 4, label: 'Ruchbah' },
                        { x: centerX + 70, y: centerY + 20, size: 4, label: 'Segin' }
                    ];
                } else if (constellation === 'Leo') {
                    stars = [
                        { x: centerX - 40, y: centerY - 60, size: 5, label: 'Regulus' },
                        { x: centerX + 70, y: centerY - 40, size: 4, label: 'Denebola' },
                        { x: centerX - 60, y: centerY - 20, size: 4, label: 'Algieba' },
                        { x: centerX + 20, y: centerY, size: 3, label: 'Zosma' },
                        { x: centerX - 10, y: centerY + 20, size: 3, label: 'Chort' },
                        { x: centerX - 70, y: centerY + 40, size: 3, label: 'Adhafera' },
                        { x: centerX - 90, y: centerY - 50, size: 3, label: 'Alterf' }
                    ];
                } else if (constellation === 'Gemini') {
                    stars = [
                        { x: centerX - 50, y: centerY - 60, size: 5, label: 'Pollux' },
                        { x: centerX + 50, y: centerY - 50, size: 5, label: 'Castor' },
                        { x: centerX - 30, y: centerY, size: 4, label: 'Alhena' },
                        { x: centerX + 30, y: centerY + 10, size: 3, label: 'Tejat' },
                        { x: centerX, y: centerY + 40, size: 3, label: 'Mebsuta' },
                        { x: centerX - 20, y: centerY + 70, size: 3, label: 'Mekbuda' },
                        { x: centerX + 60, y: centerY + 60, size: 3, label: 'Propus' }
                    ];
                } else if (constellation === 'Andromeda') {
                    stars = [
                        { x: centerX - 70, y: centerY - 40, size: 5, label: 'Alpheratz' },
                        { x: centerX - 30, y: centerY - 10, size: 4, label: 'Mirach' },
                        { x: centerX + 20, y: centerY + 20, size: 4, label: 'Almach' },
                        { x: centerX - 50, y: centerY - 30, size: 3, label: 'Delta And' },
                        { x: centerX, y: centerY, size: 3, label: 'Adhil' },
                        { x: centerX + 50, y: centerY + 40, size: 3, label: 'Upsilon And' }
                    ];
                }
                
                return stars;
            }
            
            // Redraw the constellation overlay based on current toggle states
            function redrawConstellationOverlay() {
                const state = window.constellationState;
                if (!state) return;
                
                const ctx = state.canvas;
                const width = state.width;
                const height = state.height;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw background image if enabled
                if (state.showImage && state.backgroundImage) {
                    // Draw the image with proper scaling to fit the canvas
                    const imgRatio = state.backgroundImage.width / state.backgroundImage.height;
                    const canvasRatio = width / height;
                    
                    let drawWidth, drawHeight, offsetX, offsetY;
                    
                    if (imgRatio > canvasRatio) {
                        // Image is wider than canvas (relative to height)
                        drawHeight = height;
                        drawWidth = height * imgRatio;
                        offsetX = (width - drawWidth) / 2;
                        offsetY = 0;
                    } else {
                        // Image is taller than canvas (relative to width)
                        drawWidth = width;
                        drawHeight = width / imgRatio;
                        offsetX = 0;
                        offsetY = (height - drawHeight) / 2;
                    }
                    
                    ctx.drawImage(state.backgroundImage, offsetX, offsetY, drawWidth, drawHeight);
                    
                    // Add a semi-transparent overlay for better visibility of stars and lines
                    ctx.fillStyle = 'rgba(10, 17, 40, 0.3)';
                    ctx.fillRect(0, 0, width, height);
                } else {
                    // If image is disabled, fill with dark background
                    ctx.fillStyle = '#0a1128';
                    ctx.fillRect(0, 0, width, height);
                }
                
                // Draw constellation lines if enabled (always show all possible lines)
                if (state.showLines) {
                    // Draw dimmed lines for all stars
                    drawConstellationLines(ctx, state.allStars, 0.2);
                    
                    // Draw bright lines for matched stars
                    if (state.matchedStars.length > 1) {
                        drawConstellationLines(ctx, state.matchedStars, 1.0);
                    }
                }
                
                // Draw stars if enabled
                if (state.showStars) {
                    // Draw dimmed stars for unmatched stars
                    const unmatchedStars = state.allStars.filter(star => 
                        !state.matchedStars.some(ms => ms.label === star.label));
                    
                    if (unmatchedStars.length > 0) {
                        drawStars(ctx, unmatchedStars, 0.3);
                    }
                    
                    // Draw bright stars for matched stars
                    drawStars(ctx, state.matchedStars, 1.0);
                }
                
                // Draw labels if enabled
                if (state.showLabels) {
                    // Only show labels for matched stars
                    drawLabels(ctx, state.matchedStars);
                }
            }
            
            // Draw the stars
            function drawStars(ctx, stars, opacity = 1.0) {
                stars.forEach(star => {
                    // Draw star glow
                    const gradient = ctx.createRadialGradient(
                        star.x, star.y, 0,
                        star.x, star.y, star.size * 2
                    );
                    gradient.addColorStop(0, `rgba(255, 255, 255, ${0.8 * opacity})`);
                    gradient.addColorStop(0.5, `rgba(255, 255, 255, ${0.3 * opacity})`);
                    gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                    
                    ctx.beginPath();
                    ctx.fillStyle = gradient;
                    ctx.arc(star.x, star.y, star.size * 2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Draw star center
                    ctx.beginPath();
                    ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
                    ctx.arc(star.x, star.y, star.size / 2, 0, Math.PI * 2);
                    ctx.fill();
                });
            }
            
            // Draw constellation lines with high contrast
            function drawConstellationLines(ctx, stars, opacity = 1.0) {
                if (stars.length < 2) return; // Need at least 2 stars to draw lines
                
                // Draw glow effect for lines
                ctx.strokeStyle = `rgba(79, 172, 254, ${0.3 * opacity})`;
                ctx.lineWidth = 6;
                
                // Connect stars in sequence with glow effect
                ctx.beginPath();
                ctx.moveTo(stars[0].x, stars[0].y);
                for (let i = 1; i < stars.length; i++) {
                    ctx.lineTo(stars[i].x, stars[i].y);
                }
                ctx.stroke();
                
                // Add some additional lines for more complex constellations
                if (stars.length > 5) {
                    ctx.beginPath();
                    ctx.moveTo(stars[0].x, stars[0].y);
                    ctx.lineTo(stars[3].x, stars[3].y);
                    ctx.stroke();
                    
                    if (stars.length > 6) {
                        ctx.beginPath();
                        ctx.moveTo(stars[1].x, stars[1].y);
                        ctx.lineTo(stars[5].x, stars[5].y);
                        ctx.stroke();
                    }
                }
                
                // Draw main lines with higher contrast
                ctx.strokeStyle = `rgba(79, 172, 254, ${0.9 * opacity})`;
                ctx.lineWidth = 2;
                
                // Connect stars in sequence with main lines
                ctx.beginPath();
                ctx.moveTo(stars[0].x, stars[0].y);
                for (let i = 1; i < stars.length; i++) {
                    ctx.lineTo(stars[i].x, stars[i].y);
                }
                ctx.stroke();
                
                // Add some additional lines for more complex constellations
                if (stars.length > 5) {
                    ctx.beginPath();
                    ctx.moveTo(stars[0].x, stars[0].y);
                    ctx.lineTo(stars[3].x, stars[3].y);
                    ctx.stroke();
                    
                    if (stars.length > 6) {
                        ctx.beginPath();
                        ctx.moveTo(stars[1].x, stars[1].y);
                        ctx.lineTo(stars[5].x, stars[5].y);
                        ctx.stroke();
                    }
                }
            }
            
            // Draw star labels
            function drawLabels(ctx, stars) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                
                stars.forEach(star => {
                    ctx.fillText(star.label, star.x, star.y + star.size * 3 + 5);
                });
            }
            
            // Setup visualization controls
            function setupVisualizationControls(constellation) {
                // Get control elements
                const overlayStarsToggle = document.getElementById('overlay-stars-toggle');
                const overlayLinesToggle = document.getElementById('overlay-lines-toggle');
                const overlayLabelsToggle = document.getElementById('overlay-labels-toggle');
                const overlayImageToggle = document.getElementById('overlay-image-toggle');
                
                // Overlay stars toggle
                overlayStarsToggle.addEventListener('change', function() {
                    if (window.constellationState) {
                        window.constellationState.showStars = this.checked;
                        redrawConstellationOverlay();
                    }
                });
                
                // Overlay lines toggle
                overlayLinesToggle.addEventListener('change', function() {
                    if (window.constellationState) {
                        window.constellationState.showLines = this.checked;
                        redrawConstellationOverlay();
                    }
                });
                
                // Overlay labels toggle
                overlayLabelsToggle.addEventListener('change', function() {
                    if (window.constellationState) {
                        window.constellationState.showLabels = this.checked;
                        redrawConstellationOverlay();
                    }
                });
                
                // Overlay image toggle
                overlayImageToggle.addEventListener('change', function() {
                    if (window.constellationState) {
                        window.constellationState.showImage = this.checked;
                        redrawConstellationOverlay();
                    }
                });
            }
            
            // Populate library grid
            function populateLibrary() {
                const constellations = Object.keys(constellationData);
                
                constellations.forEach(constellation => {
                    const card = document.createElement('div');
                    card.className = 'library-card';
                    card.setAttribute('data-constellation', constellation);
                    
                    const imageDiv = document.createElement('div');
                    imageDiv.className = 'library-image';
                    
                    const img = document.createElement('img');
                    img.src = `test_data/${constellation}.png`;
                    img.alt = constellation + ' Constellation';
                    img.onerror = function() {
                        // If image not found, try Normalised_Templates directory
                        this.src = `Normalised_Templates/${constellation}.png`;
                        this.onerror = function() {
                            // If still not found, show a placeholder
                            this.src = 'data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22200%22%20height%3D%22200%22%3E%3Crect%20fill%3D%22%23162552%22%20width%3D%22200%22%20height%3D%22200%22%2F%3E%3Ctext%20fill%3D%22%234facfe%22%20font-family%3D%22Arial%22%20font-size%3D%2220%22%20x%3D%2250%22%20y%3D%22100%22%3E%E2%98%85%20%E2%98%85%20%E2%98%85%3C%2Ftext%3E%3C%2Fsvg%3E';
                        };
                    };
                    
                    imageDiv.appendChild(img);
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'library-content';
                    
                    const title = document.createElement('h3');
                    title.textContent = constellation;
                    
                    const description = document.createElement('p');
                    description.textContent = constellationData[constellation].description.substring(0, 100) + '...';
                    
                    contentDiv.appendChild(title);
                    contentDiv.appendChild(description);
                    
                    card.appendChild(imageDiv);
                    card.appendChild(contentDiv);
                    
                    // Add click event
                    card.addEventListener('click', function() {
                        showConstellationDetails(constellation);
                    });
                    
                    libraryGrid.appendChild(card);
                });
            }
            
            // Show constellation details
            function showConstellationDetails(constellation) {
                const data = constellationData[constellation];
                
                // Set details
                detailConstellationName.textContent = constellation;
                detailImage.src = `test_data/${constellation}.png`;
                detailImage.onerror = function() {
                    // If image not found, try Normalised_Templates directory
                    this.src = `Normalised_Templates/${constellation}.png`;
                    this.onerror = function() {
                        // If still not found, show a placeholder
                        this.src = 'data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22200%22%20height%3D%22200%22%3E%3Crect%20fill%3D%22%23162552%22%20width%3D%22200%22%20height%3D%22200%22%2F%3E%3Ctext%20fill%3D%22%234facfe%22%20font-family%3D%22Arial%22%20font-size%3D%2220%22%20x%3D%2250%22%20y%3D%22100%22%3E%E2%98%85%20%E2%98%85%20%E2%98%85%3C%2Ftext%3E%3C%2Fsvg%3E';
                    };
                };
                
                detailClassification.textContent = data.classification;
                detailBrightestStar.textContent = data.brightestStar;
                detailVisibility.textContent = data.visibility;
                detailArea.textContent = data.area;
                detailDescription.textContent = data.description;
                detailMythology.textContent = data.mythology;
                
                // Clear and populate stars list
                detailStarsList.innerHTML = '';
                data.stars.forEach(star => {
                    const li = document.createElement('li');
                    li.textContent = star;
                    detailStarsList.appendChild(li);
                });
                
                // Show details and hide library grid
                libraryContainer.style.display = 'none';
                constellationDetails.style.display = 'block';
            }
            
            // Back to library button
            backToLibrary.addEventListener('click', function() {
                constellationDetails.style.display = 'none';
                libraryContainer.style.display = 'block';
            });
            
            // Initialize library
            populateLibrary();
            
            // Initialize history display
            try {
                updateHistoryDisplay();
                console.log('History display initialized');
            } catch (error) {
                console.error('Error initializing history display:', error);
            }
        });
    </script>
</body>
</html>